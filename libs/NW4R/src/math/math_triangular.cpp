#include <nw4r/math.h>

struct SinCosSample {
    f32 sin_val;   // 0x00
    f32 cos_val;   // 0x04
    f32 sin_delta; // 0x08
    f32 cos_delta; // 0x0C
};

struct ArcTanSample {
    f32 atan_val;   // 0x00
    f32 atan_delta; // 0x04
};

namespace nw4r {
    namespace math {
        namespace {
            static SinCosSample sSinCosTbl[] = {
                { 0.000000000f,  1.000000000f,  0.024541000f, -0.000301000f},
                { 0.024541000f,  0.999698997f,  0.024526000f, -0.000903000f},
                { 0.049068000f,  0.998794973f,  0.024497001f, -0.001505000f},
                { 0.073564999f,  0.997290015f,  0.024452999f, -0.002106000f},
                { 0.098017000f,  0.995185018f,  0.024394000f, -0.002705000f},
                { 0.122410998f,  0.992479980f,  0.024320001f, -0.003303000f},
                { 0.146730006f,  0.989176989f,  0.024231000f, -0.003899000f},
                { 0.170962006f,  0.985278010f,  0.024127999f, -0.004492000f},
                { 0.195089996f,  0.980785012f,  0.024010999f, -0.005083000f},
                { 0.219100997f,  0.975701988f,  0.023879001f, -0.005671000f},
                { 0.242980003f,  0.970031023f,  0.023732999f, -0.006255000f},
                { 0.266712993f,  0.963775992f,  0.023572000f, -0.006836000f},
                { 0.290284991f,  0.956939995f,  0.023397001f, -0.007412000f},
                { 0.313681990f,  0.949527979f,  0.023208000f, -0.007984000f},
                { 0.336890012f,  0.941543996f,  0.023004999f, -0.008551000f},
                { 0.359894991f,  0.932992995f,  0.022787999f, -0.009113000f},
                { 0.382683009f,  0.923879981f,  0.022558000f, -0.009670000f},
                { 0.405241013f,  0.914210021f,  0.022314001f, -0.010220000f},
                { 0.427554995f,  0.903989017f,  0.022056000f, -0.010765000f},
                { 0.449611008f,  0.893224001f,  0.021785000f, -0.011303000f},
                { 0.471397012f,  0.881920993f,  0.021500999f, -0.011834000f},
                { 0.492897987f,  0.870087028f,  0.021205001f, -0.012358000f},
                { 0.514102995f,  0.857729018f,  0.020895001f, -0.012875000f},
                { 0.534998000f,  0.844853997f,  0.020572999f, -0.013384000f},
                { 0.555570006f,  0.831470013f,  0.020238001f, -0.013885000f},
                { 0.575807989f,  0.817584991f,  0.019890999f, -0.014377000f},
                { 0.595699012f,  0.803207994f,  0.019532001f, -0.014861000f},
                { 0.615231991f,  0.788345993f,  0.019161999f, -0.015336000f},
                { 0.634392977f,  0.773010015f,  0.018780001f, -0.015802000f},
                { 0.653173029f,  0.757209003f,  0.018386001f, -0.016257999f},
                { 0.671558976f,  0.740951002f,  0.017982000f, -0.016704001f},
                { 0.689540982f,  0.724246979f,  0.017565999f, -0.017139999f},
                { 0.707107008f,  0.707107008f,  0.017139999f, -0.017565999f},
                { 0.724246979f,  0.689540982f,  0.016704001f, -0.017982000f},
                { 0.740951002f,  0.671558976f,  0.016257999f, -0.018386001f},
                { 0.757209003f,  0.653173029f,  0.015802000f, -0.018780001f},
                { 0.773010015f,  0.634392977f,  0.015336000f, -0.019161999f},
                { 0.788345993f,  0.615231991f,  0.014861000f, -0.019532001f},
                { 0.803207994f,  0.595699012f,  0.014377000f, -0.019890999f},
                { 0.817584991f,  0.575807989f,  0.013885000f, -0.020238001f},
                { 0.831470013f,  0.555570006f,  0.013384000f, -0.020572999f},
                { 0.844853997f,  0.534998000f,  0.012875000f, -0.020895001f},
                { 0.857729018f,  0.514102995f,  0.012358000f, -0.021205001f},
                { 0.870087028f,  0.492897987f,  0.011834000f, -0.021500999f},
                { 0.881920993f,  0.471397012f,  0.011303000f, -0.021785000f},
                { 0.893224001f,  0.449611008f,  0.010765000f, -0.022056000f},
                { 0.903989017f,  0.427554995f,  0.010220000f, -0.022314001f},
                { 0.914210021f,  0.405241013f,  0.009670000f, -0.022558000f},
                { 0.923879981f,  0.382683009f,  0.009113000f, -0.022787999f},
                { 0.932992995f,  0.359894991f,  0.008551000f, -0.023004999f},
                { 0.941543996f,  0.336890012f,  0.007984000f, -0.023208000f},
                { 0.949527979f,  0.313681990f,  0.007412000f, -0.023397001f},
                { 0.956939995f,  0.290284991f,  0.006836000f, -0.023572000f},
                { 0.963775992f,  0.266712993f,  0.006255000f, -0.023732999f},
                { 0.970031023f,  0.242980003f,  0.005671000f, -0.023879001f},
                { 0.975701988f,  0.219100997f,  0.005083000f, -0.024010999f},
                { 0.980785012f,  0.195089996f,  0.004492000f, -0.024127999f},
                { 0.985278010f,  0.170962006f,  0.003899000f, -0.024231000f},
                { 0.989176989f,  0.146730006f,  0.003303000f, -0.024320001f},
                { 0.992479980f,  0.122410998f,  0.002705000f, -0.024394000f},
                { 0.995185018f,  0.098017000f,  0.002106000f, -0.024452999f},
                { 0.997290015f,  0.073564999f,  0.001505000f, -0.024497001f},
                { 0.998794973f,  0.049068000f,  0.000903000f, -0.024526000f},
                { 0.999698997f,  0.024541000f,  0.000301000f, -0.024541000f},
                { 1.000000000f,  0.000000000f, -0.000301000f, -0.024541000f},
                { 0.999698997f, -0.024541000f, -0.000903000f, -0.024526000f},
                { 0.998794973f, -0.049068000f, -0.001505000f, -0.024497001f},
                { 0.997290015f, -0.073564999f, -0.002106000f, -0.024452999f},
                { 0.995185018f, -0.098017000f, -0.002705000f, -0.024394000f},
                { 0.992479980f, -0.122410998f, -0.003303000f, -0.024320001f},
                { 0.989176989f, -0.146730006f, -0.003899000f, -0.024231000f},
                { 0.985278010f, -0.170962006f, -0.004492000f, -0.024127999f},
                { 0.980785012f, -0.195089996f, -0.005083000f, -0.024010999f},
                { 0.975701988f, -0.219100997f, -0.005671000f, -0.023879001f},
                { 0.970031023f, -0.242980003f, -0.006255000f, -0.023732999f},
                { 0.963775992f, -0.266712993f, -0.006836000f, -0.023572000f},
                { 0.956939995f, -0.290284991f, -0.007412000f, -0.023397001f},
                { 0.949527979f, -0.313681990f, -0.007984000f, -0.023208000f},
                { 0.941543996f, -0.336890012f, -0.008551000f, -0.023004999f},
                { 0.932992995f, -0.359894991f, -0.009113000f, -0.022787999f},
                { 0.923879981f, -0.382683009f, -0.009670000f, -0.022558000f},
                { 0.914210021f, -0.405241013f, -0.010220000f, -0.022314001f},
                { 0.903989017f, -0.427554995f, -0.010765000f, -0.022056000f},
                { 0.893224001f, -0.449611008f, -0.011303000f, -0.021785000f},
                { 0.881920993f, -0.471397012f, -0.011834000f, -0.021500999f},
                { 0.870087028f, -0.492897987f, -0.012358000f, -0.021205001f},
                { 0.857729018f, -0.514102995f, -0.012875000f, -0.020895001f},
                { 0.844853997f, -0.534998000f, -0.013384000f, -0.020572999f},
                { 0.831470013f, -0.555570006f, -0.013885000f, -0.020238001f},
                { 0.817584991f, -0.575807989f, -0.014377000f, -0.019890999f},
                { 0.803207994f, -0.595699012f, -0.014861000f, -0.019532001f},
                { 0.788345993f, -0.615231991f, -0.015336000f, -0.019161999f},
                { 0.773010015f, -0.634392977f, -0.015802000f, -0.018780001f},
                { 0.757209003f, -0.653173029f, -0.016257999f, -0.018386001f},
                { 0.740951002f, -0.671558976f, -0.016704001f, -0.017982000f},
                { 0.724246979f, -0.689540982f, -0.017139999f, -0.017565999f},
                { 0.707107008f, -0.707107008f, -0.017565999f, -0.017139999f},
                { 0.689540982f, -0.724246979f, -0.017982000f, -0.016704001f},
                { 0.671558976f, -0.740951002f, -0.018386001f, -0.016257999f},
                { 0.653173029f, -0.757209003f, -0.018780001f, -0.015802000f},
                { 0.634392977f, -0.773010015f, -0.019161999f, -0.015336000f},
                { 0.615231991f, -0.788345993f, -0.019532001f, -0.014861000f},
                { 0.595699012f, -0.803207994f, -0.019890999f, -0.014377000f},
                { 0.575807989f, -0.817584991f, -0.020238001f, -0.013885000f},
                { 0.555570006f, -0.831470013f, -0.020572999f, -0.013384000f},
                { 0.534998000f, -0.844853997f, -0.020895001f, -0.012875000f},
                { 0.514102995f, -0.857729018f, -0.021205001f, -0.012358000f},
                { 0.492897987f, -0.870087028f, -0.021500999f, -0.011834000f},
                { 0.471397012f, -0.881920993f, -0.021785000f, -0.011303000f},
                { 0.449611008f, -0.893224001f, -0.022056000f, -0.010765000f},
                { 0.427554995f, -0.903989017f, -0.022314001f, -0.010220000f},
                { 0.405241013f, -0.914210021f, -0.022558000f, -0.009670000f},
                { 0.382683009f, -0.923879981f, -0.022787999f, -0.009113000f},
                { 0.359894991f, -0.932992995f, -0.023004999f, -0.008551000f},
                { 0.336890012f, -0.941543996f, -0.023208000f, -0.007984000f},
                { 0.313681990f, -0.949527979f, -0.023397001f, -0.007412000f},
                { 0.290284991f, -0.956939995f, -0.023572000f, -0.006836000f},
                { 0.266712993f, -0.963775992f, -0.023732999f, -0.006255000f},
                { 0.242980003f, -0.970031023f, -0.023879001f, -0.005671000f},
                { 0.219100997f, -0.975701988f, -0.024010999f, -0.005083000f},
                { 0.195089996f, -0.980785012f, -0.024127999f, -0.004492000f},
                { 0.170962006f, -0.985278010f, -0.024231000f, -0.003899000f},
                { 0.146730006f, -0.989176989f, -0.024320001f, -0.003303000f},
                { 0.122410998f, -0.992479980f, -0.024394000f, -0.002705000f},
                { 0.098017000f, -0.995185018f, -0.024452999f, -0.002106000f},
                { 0.073564999f, -0.997290015f, -0.024497001f, -0.001505000f},
                { 0.049068000f, -0.998794973f, -0.024526000f, -0.000903000f},
                { 0.024541000f, -0.999698997f, -0.024541000f, -0.000301000f},
                { 0.000000000f, -1.000000000f, -0.024541000f,  0.000301000f},
                {-0.024541000f, -0.999698997f, -0.024526000f,  0.000903000f},
                {-0.049068000f, -0.998794973f, -0.024497001f,  0.001505000f},
                {-0.073564999f, -0.997290015f, -0.024452999f,  0.002106000f},
                {-0.098017000f, -0.995185018f, -0.024394000f,  0.002705000f},
                {-0.122410998f, -0.992479980f, -0.024320001f,  0.003303000f},
                {-0.146730006f, -0.989176989f, -0.024231000f,  0.003899000f},
                {-0.170962006f, -0.985278010f, -0.024127999f,  0.004492000f},
                {-0.195089996f, -0.980785012f, -0.024010999f,  0.005083000f},
                {-0.219100997f, -0.975701988f, -0.023879001f,  0.005671000f},
                {-0.242980003f, -0.970031023f, -0.023732999f,  0.006255000f},
                {-0.266712993f, -0.963775992f, -0.023572000f,  0.006836000f},
                {-0.290284991f, -0.956939995f, -0.023397001f,  0.007412000f},
                {-0.313681990f, -0.949527979f, -0.023208000f,  0.007984000f},
                {-0.336890012f, -0.941543996f, -0.023004999f,  0.008551000f},
                {-0.359894991f, -0.932992995f, -0.022787999f,  0.009113000f},
                {-0.382683009f, -0.923879981f, -0.022558000f,  0.009670000f},
                {-0.405241013f, -0.914210021f, -0.022314001f,  0.010220000f},
                {-0.427554995f, -0.903989017f, -0.022056000f,  0.010765000f},
                {-0.449611008f, -0.893224001f, -0.021785000f,  0.011303000f},
                {-0.471397012f, -0.881920993f, -0.021500999f,  0.011834000f},
                {-0.492897987f, -0.870087028f, -0.021205001f,  0.012358000f},
                {-0.514102995f, -0.857729018f, -0.020895001f,  0.012875000f},
                {-0.534998000f, -0.844853997f, -0.020572999f,  0.013384000f},
                {-0.555570006f, -0.831470013f, -0.020238001f,  0.013885000f},
                {-0.575807989f, -0.817584991f, -0.019890999f,  0.014377000f},
                {-0.595699012f, -0.803207994f, -0.019532001f,  0.014861000f},
                {-0.615231991f, -0.788345993f, -0.019161999f,  0.015336000f},
                {-0.634392977f, -0.773010015f, -0.018780001f,  0.015802000f},
                {-0.653173029f, -0.757209003f, -0.018386001f,  0.016257999f},
                {-0.671558976f, -0.740951002f, -0.017982000f,  0.016704001f},
                {-0.689540982f, -0.724246979f, -0.017565999f,  0.017139999f},
                {-0.707107008f, -0.707107008f, -0.017139999f,  0.017565999f},
                {-0.724246979f, -0.689540982f, -0.016704001f,  0.017982000f},
                {-0.740951002f, -0.671558976f, -0.016257999f,  0.018386001f},
                {-0.757209003f, -0.653173029f, -0.015802000f,  0.018780001f},
                {-0.773010015f, -0.634392977f, -0.015336000f,  0.019161999f},
                {-0.788345993f, -0.615231991f, -0.014861000f,  0.019532001f},
                {-0.803207994f, -0.595699012f, -0.014377000f,  0.019890999f},
                {-0.817584991f, -0.575807989f, -0.013885000f,  0.020238001f},
                {-0.831470013f, -0.555570006f, -0.013384000f,  0.020572999f},
                {-0.844853997f, -0.534998000f, -0.012875000f,  0.020895001f},
                {-0.857729018f, -0.514102995f, -0.012358000f,  0.021205001f},
                {-0.870087028f, -0.492897987f, -0.011834000f,  0.021500999f},
                {-0.881920993f, -0.471397012f, -0.011303000f,  0.021785000f},
                {-0.893224001f, -0.449611008f, -0.010765000f,  0.022056000f},
                {-0.903989017f, -0.427554995f, -0.010220000f,  0.022314001f},
                {-0.914210021f, -0.405241013f, -0.009670000f,  0.022558000f},
                {-0.923879981f, -0.382683009f, -0.009113000f,  0.022787999f},
                {-0.932992995f, -0.359894991f, -0.008551000f,  0.023004999f},
                {-0.941543996f, -0.336890012f, -0.007984000f,  0.023208000f},
                {-0.949527979f, -0.313681990f, -0.007412000f,  0.023397001f},
                {-0.956939995f, -0.290284991f, -0.006836000f,  0.023572000f},
                {-0.963775992f, -0.266712993f, -0.006255000f,  0.023732999f},
                {-0.970031023f, -0.242980003f, -0.005671000f,  0.023879001f},
                {-0.975701988f, -0.219100997f, -0.005083000f,  0.024010999f},
                {-0.980785012f, -0.195089996f, -0.004492000f,  0.024127999f},
                {-0.985278010f, -0.170962006f, -0.003899000f,  0.024231000f},
                {-0.989176989f, -0.146730006f, -0.003303000f,  0.024320001f},
                {-0.992479980f, -0.122410998f, -0.002705000f,  0.024394000f},
                {-0.995185018f, -0.098017000f, -0.002106000f,  0.024452999f},
                {-0.997290015f, -0.073564999f, -0.001505000f,  0.024497001f},
                {-0.998794973f, -0.049068000f, -0.000903000f,  0.024526000f},
                {-0.999698997f, -0.024541000f, -0.000301000f,  0.024541000f},
                {-1.000000000f, -0.000000000f,  0.000301000f,  0.024541000f},
                {-0.999698997f,  0.024541000f,  0.000903000f,  0.024526000f},
                {-0.998794973f,  0.049068000f,  0.001505000f,  0.024497001f},
                {-0.997290015f,  0.073564999f,  0.002106000f,  0.024452999f},
                {-0.995185018f,  0.098017000f,  0.002705000f,  0.024394000f},
                {-0.992479980f,  0.122410998f,  0.003303000f,  0.024320001f},
                {-0.989176989f,  0.146730006f,  0.003899000f,  0.024231000f},
                {-0.985278010f,  0.170962006f,  0.004492000f,  0.024127999f},
                {-0.980785012f,  0.195089996f,  0.005083000f,  0.024010999f},
                {-0.975701988f,  0.219100997f,  0.005671000f,  0.023879001f},
                {-0.970031023f,  0.242980003f,  0.006255000f,  0.023732999f},
                {-0.963775992f,  0.266712993f,  0.006836000f,  0.023572000f},
                {-0.956939995f,  0.290284991f,  0.007412000f,  0.023397001f},
                {-0.949527979f,  0.313681990f,  0.007984000f,  0.023208000f},
                {-0.941543996f,  0.336890012f,  0.008551000f,  0.023004999f},
                {-0.932992995f,  0.359894991f,  0.009113000f,  0.022787999f},
                {-0.923879981f,  0.382683009f,  0.009670000f,  0.022558000f},
                {-0.914210021f,  0.405241013f,  0.010220000f,  0.022314001f},
                {-0.903989017f,  0.427554995f,  0.010765000f,  0.022056000f},
                {-0.893224001f,  0.449611008f,  0.011303000f,  0.021785000f},
                {-0.881920993f,  0.471397012f,  0.011834000f,  0.021500999f},
                {-0.870087028f,  0.492897987f,  0.012358000f,  0.021205001f},
                {-0.857729018f,  0.514102995f,  0.012875000f,  0.020895001f},
                {-0.844853997f,  0.534998000f,  0.013384000f,  0.020572999f},
                {-0.831470013f,  0.555570006f,  0.013885000f,  0.020238001f},
                {-0.817584991f,  0.575807989f,  0.014377000f,  0.019890999f},
                {-0.803207994f,  0.595699012f,  0.014861000f,  0.019532001f},
                {-0.788345993f,  0.615231991f,  0.015336000f,  0.019161999f},
                {-0.773010015f,  0.634392977f,  0.015802000f,  0.018780001f},
                {-0.757209003f,  0.653173029f,  0.016257999f,  0.018386001f},
                {-0.740951002f,  0.671558976f,  0.016704001f,  0.017982000f},
                {-0.724246979f,  0.689540982f,  0.017139999f,  0.017565999f},
                {-0.707107008f,  0.707107008f,  0.017565999f,  0.017139999f},
                {-0.689540982f,  0.724246979f,  0.017982000f,  0.016704001f},
                {-0.671558976f,  0.740951002f,  0.018386001f,  0.016257999f},
                {-0.653173029f,  0.757209003f,  0.018780001f,  0.015802000f},
                {-0.634392977f,  0.773010015f,  0.019161999f,  0.015336000f},
                {-0.615231991f,  0.788345993f,  0.019532001f,  0.014861000f},
                {-0.595699012f,  0.803207994f,  0.019890999f,  0.014377000f},
                {-0.575807989f,  0.817584991f,  0.020238001f,  0.013885000f},
                {-0.555570006f,  0.831470013f,  0.020572999f,  0.013384000f},
                {-0.534998000f,  0.844853997f,  0.020895001f,  0.012875000f},
                {-0.514102995f,  0.857729018f,  0.021205001f,  0.012358000f},
                {-0.492897987f,  0.870087028f,  0.021500999f,  0.011834000f},
                {-0.471397012f,  0.881920993f,  0.021785000f,  0.011303000f},
                {-0.449611008f,  0.893224001f,  0.022056000f,  0.010765000f},
                {-0.427554995f,  0.903989017f,  0.022314001f,  0.010220000f},
                {-0.405241013f,  0.914210021f,  0.022558000f,  0.009670000f},
                {-0.382683009f,  0.923879981f,  0.022787999f,  0.009113000f},
                {-0.359894991f,  0.932992995f,  0.023004999f,  0.008551000f},
                {-0.336890012f,  0.941543996f,  0.023208000f,  0.007984000f},
                {-0.313681990f,  0.949527979f,  0.023397001f,  0.007412000f},
                {-0.290284991f,  0.956939995f,  0.023572000f,  0.006836000f},
                {-0.266712993f,  0.963775992f,  0.023732999f,  0.006255000f},
                {-0.242980003f,  0.970031023f,  0.023879001f,  0.005671000f},
                {-0.219100997f,  0.975701988f,  0.024010999f,  0.005083000f},
                {-0.195089996f,  0.980785012f,  0.024127999f,  0.004492000f},
                {-0.170962006f,  0.985278010f,  0.024231000f,  0.003899000f},
                {-0.146730006f,  0.989176989f,  0.024320001f,  0.003303000f},
                {-0.122410998f,  0.992479980f,  0.024394000f,  0.002705000f},
                {-0.098017000f,  0.995185018f,  0.024452999f,  0.002106000f},
                {-0.073564999f,  0.997290015f,  0.024497001f,  0.001505000f},
                {-0.049068000f,  0.998794973f,  0.024526000f,  0.000903000f},
                {-0.024541000f,  0.999698997f,  0.024541000f,  0.000301000f},
                {-0.000000000f,  1.000000000f,  0.024541000f, -0.000301000f}
            };

            static ArcTanSample sArcTanTbl[] = {
                {0.000000000f,  1.272825360f},
                {1.272825360f,  1.270345807f},
                {2.543171167f,  1.265415549f},
                {3.808586597f,  1.258091569f},
                {5.066678524f,  1.248457074f},
                {6.315135479f,  1.236619473f},
                {7.551754951f,  1.222707152f},
                {8.774461746f,  1.206866622f},
                {9.981328964f,  1.189258218f},
                {11.170586586f, 1.170052886f},
                {12.340640068f, 1.149428010f},
                {13.490067482f, 1.127564430f},
                {14.617631912f, 1.104642272f},
                {15.722274780f, 1.080838680f},
                {16.803113937f, 1.056325078f},
                {17.859437943f, 1.031264901f},
                {18.890703201f, 1.005812049f},
                {19.896514893f, 0.980109632f},
                {20.876625061f, 0.954289079f},
                {21.830913544f, 0.928469777f},
                {22.759384155f, 0.902758956f},
                {23.662141800f, 0.877251565f},
                {24.539394379f, 0.852030873f},
                {25.391424179f, 0.827168882f},
                {26.218593597f, 0.802726984f},
                {27.021320343f, 0.778756559f},
                {27.800077438f, 0.755300105f},
                {28.555377960f, 0.732391477f},
                {29.287769318f, 0.710057378f},
                {29.997825623f, 0.688317478f},
                {30.686143875f, 0.667185664f},
                {31.353328705f, 0.646670520f},
                {32.000000000f, 0.626776159f}
            };

            f32 AtanFIdx_(f32 x) {
                x *= 32.0f;

                u16 whole = F32ToU16(x);
                f32 frac = x - U16ToF32(whole);

                f32 atan = sArcTanTbl[whole].atan_val + frac * sArcTanTbl[whole].atan_delta;

                return atan;
            }
        }

        f32 SinFIdx(f32 fidx) {
            f32 abs_fidx = FAbs(fidx);

            while (abs_fidx >= 65536.0f) {
                abs_fidx -= 65536.0f;
            }

            u16 whole = F32ToU16(abs_fidx);
            f32 frac = abs_fidx - U16ToF32(whole);

            f32 sin = sSinCosTbl[whole & 255].sin_val + frac * sSinCosTbl[whole & 255].sin_delta;

            return (fidx < 0.0f) ? -sin : sin;
        }

        f32 CosFIdx(f32 fidx) {
            f32 abs_fidx = FAbs(fidx);

            while (abs_fidx >= 65536.0f) {
                abs_fidx -= 65536.0f;
            }

            u16 whole = F32ToU16(abs_fidx);
            f32 frac = abs_fidx - U16ToF32(whole);

            f32 cos = sSinCosTbl[whole & 255].cos_val + frac * sSinCosTbl[whole & 255].cos_delta;

            return cos;
        }

        f32 AtanFIdx(f32 x) {
            if (x >= 0.0f) {
                if (x > 1.0f) {
                    return 64.0f - AtanFIdx_(1.0f / x);
                } else {
                    return AtanFIdx_(x);
                }
            } else {
                if (x < -1.0f) {
                    return AtanFIdx_(-1.0f / x) + -64.0f;
                } else {
                    return -AtanFIdx_(-x);
                }
            }
        }

        f32 Atan2FIdx(f32 y, f32 x) {
            f32 a;
            f32 b;
            f32 c;
            bool minus;

            if (x == 0.0f && y == 0.0f)
                return 0.0f;

            if (x >= 0.0f) {
                if (y >= 0.0f) {
                    if (x >= y) {
                        a = x;
                        b = y;
                        c = 0.0f;

                        minus = false;
                    }
                    else {
                        a = y;
                        b = x;
                        c = 64.0f;

                        minus = true;
                    }
                }
                else {
                    if (x >= -y) {
                        a =  x;
                        b = -y;
                        c = 0.0f;

                        minus = true;
                    }
                    else {
                        a = -y;
                        b =  x;
                        c = -64.0f;

                        minus = false;
                    }
                }
            }
            else {
                if (y >= 0.0f) {
                    if (-x >= y) {
                        a = -x;
                        b =  y;
                        c = 128.0f;

                        minus = true;
                    }
                    else {
                        a =  y;
                        b = -x;
                        c = 64.0f;

                        minus = false;
                    }
                }
                else {
                    if (-x >= -y) {
                        a = -x;
                        b = -y;
                        c = -128.0f;

                        minus = false;
                    }
                    else {
                        a = -y;
                        b = -x;
                        c = -64.0f;

                        minus = true;
                    }
                }
            }

            return minus ? c - AtanFIdx_(b / a) : c + AtanFIdx_(b / a);
        }
    }
}
